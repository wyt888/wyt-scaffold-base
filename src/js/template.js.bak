
const doc = document;
function getNumFormat(num) {
  return Number(num) > 9 ? num : '0' + num
}

function getCurTime() {
  var _date = new Date();
  return `${getNumFormat(_date.getHours())}:${getNumFormat(_date.getMinutes())}`
}

function getImgEle(src) {
  return `<img src="${src}" alt="">`
}

function getGoods(info) {
  let res = '';
  let len = 0;
  if (info) {
    len = info.length > 2 ? 3 : info.length;
  }
  for (let i = 0; i < len; i++) {
    //   res += `
    //   <div class="page__sss-products-img">${getImgEle('https://si.geilicdn.com/vshop400252989-1471512616.jpeg?w=250&h=250')}</div>
    // `;
    res += `<div class="page__sss-products-img">${getImgEle(info[i].itemMainPic)}</div>`;
  }
  return res
}

function getSayIng(infos) {
  return infos.text;
}

function renderSaying(shopInfo) {
  let res = '';
  if (shopInfo.sayingNum) {
    res += `
      <div class="page__sss-title">回头客说 - <span>${shopInfo.sayingNum}</span>条</div>
      <div class="page__sss-desc">${getSayIng(shopInfo.saying)}</div>
    `;
  } else {
    res += `<div class="page__sss-title">店铺公告</div>`;
    if (shopInfo.shopNote) {
      res += `<div class="page__sss-desc">${shopInfo.shopNote}</div>`;
    } else {
      res += '<div class="page__sss-desc">欢迎光临小店，我的产品就是我最好的名片。小店给你好回忆，比一个忆更有意义！</div>';
    }
  }


  return res;
}

function renderBody(userInfo, shopInfo, qrCode) {
  return `
  <section class="page__screenshot">
    <div class="page__ssu-time">${getCurTime()}</div>
    <div class="page__ssu-photo">${getImgEle(userInfo.headImg)}</div>
    <div class="page__ssu-name"></div>
    <div class="page__ssu-shop">
      <div class="page__sss-info">
        <div class="page__sss-logo">${getImgEle(shopInfo.shopLogo)}</div>
        <div class="page__sss-data">
          <p class="page__sss-name"></p>
          <div class="page__sss-statistic">
            <div class="page__sss-headBack">回头率 ${shopInfo.shopRepurRate || 0}%</div>
            <div class="page__sss-line"></div>
            <div class="page__sss-buyNum">${shopInfo.buyNum || 0} 人买过</div>
          </div>
        </div>
        <div class="page__sss-btn">收藏</div>
      </div>
      <div class="page__sss-products">${getGoods(shopInfo.topItems)}</div>
      <div class="page__sss-custom">${renderSaying(shopInfo)}</div>
    </div>
    <div class="page__ss-mask">
      <div class="page__ss-qrcode">${getImgEle(qrCode)}</div>
    </div>
  </section>
  `
}

export function getPicTemp(userInfo, shopInfo, qrCode) {
  let dom = doc.createElement('div');

  dom.innerHTML = renderBody(userInfo, shopInfo, qrCode);

  // 文本单独插入 防止转义
  dom.querySelector('.page__ssu-name').textContent = `--${userInfo.nickname}`;
  dom.querySelector('.page__sss-name').textContent = `${shopInfo.shopName}`;
  return dom.querySelector('.page__screenshot');
}